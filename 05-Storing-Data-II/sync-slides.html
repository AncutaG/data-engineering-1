<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Week 05 - sync session">
  <title>Fundamentals of Data Engineering</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="reveal.js/css/reveal.css">
  <style type="text/css">code{white-space: pre;}</style>
  <link rel="stylesheet" href="reveal.js/css/theme/mids.css" id="theme">
  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal.js/css/print/pdf.css' : 'reveal.js/css/print/paper.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  </script>
  <!--[if lt IE 9]>
  <script src="reveal.js/lib/js/html5shiv.js"></script>
  <![endif]-->
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section>
  <h1 class="title">Fundamentals of Data Engineering</h1>
  <h2 class="author">Week 05 - sync session</h2>
  <img class="frontPageSlogan" src="http://people.ischool.berkeley.edu/~mark.mims/course-development/2017-mids-w205/media/datascience-at-berkeley.png"/>
</section>

<section id="section" class="slide level1">
<h1></h1>
<section id="while-were-getting-started" class="level2">
<h2>While we’re getting started</h2>
<ul>
<li>Review your Assignment 04</li>
<li>Get ready to share</li>
</ul>
<aside class="notes">
<p>Breakout at about 5 after the hour: - Check in with each group on their solution to the assignment - Answer questions as people have them on what they had trouble with - Have 3-4 people present</p>
</aside>
</section>
<section id="due-friday-pr" class="level2">
<h2>Due Friday (PR)</h2>
</section>
</section>
<section id="section-1" class="slide level1">
<h1></h1>
<section id="where-are-we" class="level2">
<h2>Where are we?</h2>
</section>
<section id="today" class="level2">
<h2>Today</h2>
<ul>
<li>Assignment 04</li>
<li>Run standalone kafka cluster</li>
<li>NoSQL stores with docker compose</li>
</ul>
<aside class="notes">
<ul>
<li><p>Watching RDBs and NoSQL videos b/t week 4 &amp; week 5</p></li>
<li>spin up 2 containers: redis &amp; midsw205/base</li>
<li>run python in one that’s talking to redis in the other</li>
<li>(docker compose + how to run a notebook in the container)</li>
</ul>
</aside>
</section>
<section id="between-class-5-class-6" class="level2">
<h2>Between Class 5 &amp; Class 6</h2>
<ul>
<li>async material in Week 5 syllabus (Virtualization, Hadoop)</li>
<li>Readings in Week 5 syllabus</li>
<li>Assignment 05 (notebook to present)</li>
<li>Final Assignment 04 due on Friday</li>
</ul>
</section>
<section id="class-6" class="level2">
<h2>Class 6</h2>
<ul>
<li>Final presentations of Query Project Notebooks/Recommendations</li>
<li>Tracking User Activity Project (spans Assignments 6-8)</li>
</ul>
</section>
</section>
<section id="section-2" class="slide level1">
<h1></h1>
<section id="standalone-kafka-cluster" class="level2">
<h2>Standalone kafka cluster</h2>
</section>
<section id="update-your-course-content-repo-in-w205" class="level2">
<h2>Update your course content repo in w205</h2>
<p><code>cd w205</code> <code>cd course-content</code> <code>git pull --all</code></p>
</section>
<section id="docker-compose-.yml-file" class="level2">
<h2>Docker compose .yml file</h2>
<ul>
<li><code>cd w205</code></li>
<li><code>mkdir kafka</code></li>
<li>save <code>docker-compose.yml</code> from recently pulled <code>~/w205/course-content</code> to recently created <code>~/w205/kafka</code> directory</li>
</ul>
<aside class="notes">
<p>Save the following snippet as <code>~/w205/kafka/docker-compose.yml</code> on your host filesystem</p>
<pre><code>---
version: &#39;2&#39;
services:
  zookeeper:
    image: confluentinc/cp-zookeeper:latest
    network_mode: host
    environment:
      ZOOKEEPER_CLIENT_PORT: 32181
      ZOOKEEPER_TICK_TIME: 2000
    extra_hosts:
      - &quot;moby:127.0.0.1&quot;

  kafka:
    image: confluentinc/cp-kafka:latest
    network_mode: host
    depends_on:
      - zookeeper
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: localhost:32181
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://localhost:29092
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
    extra_hosts:
      - &quot;moby:127.0.0.1&quot;</code></pre>
</aside>
</section>
<section id="run-the-cluster" class="level2">
<h2>Run the cluster</h2>
<pre><code>cd ~/w205/kafka
docker-compose up -d</code></pre>
</section>
<section id="verify-things-started-up-ok" class="level2">
<h2>Verify things started up ok</h2>
<pre><code>docker-compose ps</code></pre>
</section>
<section id="should-see-something-like" class="level2">
<h2>Should see something like</h2>
<pre><code>Name                        Command            State   Ports
-----------------------------------------------------------------------
kafkasinglenode_kafka_1       /etc/confluent/docker/run   Up
kafkasinglenode_zookeeper_1   /etc/confluent/docker/run   Up</code></pre>
</section>
<section id="check-zookeeper" class="level2">
<h2>Check zookeeper</h2>
<pre><code>docker-compose logs zookeeper | grep -i binding</code></pre>
</section>
<section id="should-see-something-like-1" class="level2">
<h2>Should see something like</h2>
<pre><code>zookeeper_1  | \
[2016-07-25 03:26:04,018] \
INFO binding to port 0.0.0.0/0.0.0.0:32181 \
(org.apache.zookeeper.server.NIOServerCnxnFactory)</code></pre>
</section>
<section id="check-the-kafka-broker" class="level2">
<h2>Check the kafka broker</h2>
<pre><code>docker-compose logs kafka | grep -i started</code></pre>
</section>
<section id="should-see-something-like-2" class="level2">
<h2>Should see something like</h2>
<pre><code>kafka_1      | [2017-08-31 00:31:40,244] INFO [Socket Server on Broker 1], Started 1 acceptor threads (kafka.network.SocketServer)
kafka_1      | [2017-08-31 00:31:40,426] INFO [Replica state machine on controller 1]: Started replica state machine with initial state -&gt; Map() (kafka.controller.ReplicaStateMachine)
kafka_1      | [2017-08-31 00:31:40,436] INFO [Partition state machine on Controller 1]: Started partition state machine with initial state -&gt; Map() (kafka.controller.PartitionStateMachine)
kafka_1      | [2017-08-31 00:31:40,540] INFO [Kafka Server 1], started (kafka.server.KafkaServer)</code></pre>
<aside class="notes">
<ul>
<li>Scroll on the slides that show screen results</li>
<li>We want it to look like what they’ll see on their screens</li>
</ul>
</aside>
</section>
</section>
<section id="section-3" class="slide level1">
<h1></h1>
<section id="testing-things-out" class="level2">
<h2>Testing things out</h2>
</section>
<section id="create-a-topic-foo" class="level2">
<h2>Create a Topic <code>foo</code></h2>
<pre><code>    docker-compose exec \
    kafka kafka-topics --create --topic foo \
    --partitions 1 --replication-factor 1 \
    --if-not-exists --zookeeper \
    localhost:32181</code></pre>
<aside class="notes">
<pre><code>docker-compose exec kafka kafka-topics --create --topic foo --partitions 1 --replication-factor 1 --if-not-exists --zookeeper localhost:32181</code></pre>
</aside>
</section>
<section id="should-see-something-like-3" class="level2">
<h2>Should see something like</h2>
<pre><code>Created topic &quot;foo&quot;.</code></pre>
</section>
<section id="check-the-topic" class="level2">
<h2>Check the topic</h2>
<pre><code>    docker-compose exec \
    kafka kafka-topics --describe --topic foo \
    --zookeeper localhost:32181</code></pre>
<aside class="notes">
<pre><code>docker-compose exec kafka kafka-topics --describe --topic foo --zookeeper localhost:32181</code></pre>
</aside>
</section>
<section id="should-see-something-like-4" class="level2">
<h2>Should see something like</h2>
<pre><code>Topic:foo   PartitionCount:1    ReplicationFactor:1 Configs:
Topic: foo  Partition: 0    Leader: 1    Replicas: 1  Isr: 1</code></pre>
</section>
</section>
<section id="section-4" class="slide level1">
<h1></h1>
<section id="publish-and-consume-messages" class="level2">
<h2>Publish and Consume Messages</h2>
</section>
<section id="publish-messages" class="level2">
<h2>Publish Messages</h2>
<ul>
<li>Use the kafka console producer to publish some test messages to that topic</li>
</ul>
<pre><code>    docker-compose exec \
    kafka bash -c &quot;seq 42 | kafka-console-producer \
    --request-required-acks 1 \
    --broker-list localhost:29092 \
    --topic foo &amp;&amp; echo &#39;Produced 42 messages.&#39;&quot;</code></pre>
<aside class="notes">
<pre><code>docker-compose exec kafka bash -c &quot;seq 42 | kafka-console-producer --request-required-acks 1 --broker-list localhost:29092 --topic foo &amp;&amp; echo &#39;Produced 42 messages.&#39;&quot;</code></pre>
</aside>
</section>
<section id="should-see-something-like-5" class="level2">
<h2>Should see something like</h2>
<pre><code>Produced 42 messages.</code></pre>
</section>
<section id="consume-messages" class="level2">
<h2>Consume Messages</h2>
<ul>
<li>Start a consumer to read from that topic</li>
</ul>
<pre><code>    docker-compose exec \
    kafka kafka-console-consumer \
    --bootstrap-server localhost:29092 \
    --topic foo --from-beginning --max-messages 42</code></pre>
<aside class="notes">
<pre><code>docker-compose exec kafka kafka-console-consumer --bootstrap-server localhost:29092 --topic foo --from-beginning --max-messages 42</code></pre>
</aside>
</section>
<section id="should-see-something-like-6" class="level2">
<h2>Should see something like</h2>
<pre><code>1
....
42
Processed a total of 42 messages</code></pre>
<ul>
<li>The consumer can be created before, during, or after the producer’s run.</li>
</ul>
</section>
</section>
<section id="section-5" class="slide level1">
<h1></h1>
<section id="clean-up" class="level2">
<h2>Clean Up</h2>
</section>
<section id="tearing-things-down" class="level2">
<h2>Tearing things down</h2>
<pre><code>docker-compose down</code></pre>
</section>
</section>
<section id="section-6" class="slide level1">
<h1></h1>
<section id="docker-compose-with-redis" class="level2">
<h2>Docker-compose with Redis</h2>
<aside class="notes">
<p>something about what we’re going to do</p>
</aside>
</section>
<section id="setup" class="level2">
<h2>Setup</h2>
</section>
<section id="create-a-workspace-for-this-example" class="level2">
<h2>Create a workspace for this example</h2>
<pre><code>mkdir ~/w205/redis
cd ~/w205/redis</code></pre>
</section>
<section id="save-the-following-to-docker-compose.yml-in-that-directory" class="level2">
<h2>Save the following to <code>docker-compose.yml</code> in that directory</h2>
<pre><code>---
version: &#39;2&#39;
services:
  redis:
    image: redis:latest
    expose:
      - &quot;6379&quot;
    extra_hosts:
      - &quot;moby:127.0.0.1&quot;

  mids:
    image: midsw205/base:latest
    stdin_open: true
    tty: true
    extra_hosts:
      - &quot;moby:127.0.0.1&quot;</code></pre>
</section>
<section id="spinup" class="level2">
<h2>Spinup</h2>
<ul>
<li><p>Start up the cluster</p>
<p>docker-compose up -d</p></li>
</ul>
</section>
<section id="check-stuff" class="level2">
<h2>Check stuff</h2>
<pre><code>docker-compose ps</code></pre>
</section>
<section id="should-see" class="level2">
<h2>Should see</h2>
<pre><code>         Name                        Command               State    Ports     
---------------------------------------------------------------------------
redisexample_midsbase_1   /bin/bash                        Up      8888/tcp 
redisexample_redis_1      docker-entrypoint.sh redis ...   Up      6379/tcp </code></pre>
</section>
<section id="peek-at-the-logs" class="level2">
<h2>Peek at the logs</h2>
<pre><code>docker-compose logs redis</code></pre>
</section>
<section id="should-see-log-output-ending-in" class="level2">
<h2>Should see log output ending in</h2>
<pre><code>Ready to accept connections</code></pre>
</section>
<section id="run-stuff" class="level2">
<h2>Run stuff</h2>
<ul>
<li><p>Connect to the mids container</p>
<p>docker-compose exec mids bash</p></li>
</ul>
</section>
<section id="at-the-prompt-run" class="level2">
<h2>At the prompt, run</h2>
<pre><code>ipython</code></pre>
</section>
<section id="try-out-redis" class="level2">
<h2>Try out redis</h2>
<pre><code>import redis
r = redis.Redis(host=&#39;redis&#39;, port=&#39;6379&#39;)
r.keys()
exit</code></pre>
</section>
<section id="exit-that-container" class="level2">
<h2>Exit that container</h2>
<pre><code>exit</code></pre>
</section>
<section id="tear-down-your-stack" class="level2">
<h2>Tear down your stack</h2>
<pre><code>docker-compose down</code></pre>
</section>
<section id="verify" class="level2">
<h2>Verify</h2>
<pre><code>docker-compose ps</code></pre>
</section>
</section>
<section id="section-7" class="slide level1">
<h1></h1>
<section id="jupyter-notebooks" class="level2">
<h2>Jupyter Notebooks</h2>
</section>
<section id="change-the-docker-compose.yml-file" class="level2">
<h2>Change the <code>docker-compose.yml</code> file</h2>
<pre><code>---
version: &#39;2&#39;
services:
  redis:
    image: redis:latest
    expose:
      - &quot;6379&quot;
    extra_hosts:
      - &quot;moby:127.0.0.1&quot;

  mids:
    image: midsw205/base:latest
    stdin_open: true
    tty: true
    expose:
      - &quot;8888&quot;
    ports:
      - &quot;8888:8888&quot;
    extra_hosts:
      - &quot;moby:127.0.0.1&quot;</code></pre>
<aside class="notes">
<ul>
<li>Add a port for the <code>mids</code> service</li>
</ul>
</aside>
</section>
<section id="save-that-and-bring-it-up" class="level2">
<h2>Save that and bring it up</h2>
<pre><code>docker-compose up -d</code></pre>
</section>
<section id="start-up-a-notebook" class="level2">
<h2>Start up a notebook</h2>
<pre><code>docker-compose exec mids jupyter notebook --no-browser --port 8888 --ip 0.0.0.0 --allow-root</code></pre>
</section>
<section id="copy-token-should-look-something-like" class="level2">
<h2>Copy token… should look something like</h2>
<pre><code>open http://0.0.0.0:8888/?token=&lt;your token&gt;</code></pre>
</section>
<section id="open-a-browser" class="level2">
<h2>Open a browser</h2>
<pre><code>http://0.0.0.0:8888</code></pre>
</section>
<section id="paste-token" class="level2">
<h2>Paste token</h2>
</section>
<section id="drop-the-cluster-when-youre-done" class="level2">
<h2>Drop the cluster when you’re done</h2>
<pre><code>docker-compose down</code></pre>
</section>
</section>
<section id="section-8" class="slide level1">
<h1></h1>
<section id="automate-notebook-startup" class="level2">
<h2>Automate notebook startup</h2>
<p>Just for fun,</p>
<pre><code>---
version: &#39;2&#39;
services:
  redis:
    image: redis:latest
    expose:
      - &quot;6379&quot;
    extra_hosts:
      - &quot;moby:127.0.0.1&quot;

  mids:
    image: midsw205/base:latest
    stdin_open: true
    tty: true
    expose:
      - &quot;8888&quot;
    extra_hosts:
      - &quot;moby:127.0.0.1&quot;
    command: jupyter notebook --no-browser --port 8888 --ip 0.0.0.0 --allow-root</code></pre>
</section>
<section id="test-it-out" class="level2">
<h2>Test it out</h2>
<pre><code>docker-compose up -d</code></pre>
</section>
<section id="run-to-get-the-token" class="level2">
<h2>Run to get the token</h2>
<pre><code>docker-compose logs mids</code></pre>
</section>
<section id="open-a-browser-1" class="level2">
<h2>Open a browser</h2>
<pre><code>open http://0.0.0.0:8888/?token=&lt;your token&gt;</code></pre>
</section>
<section id="open-new-python3-notebook" class="level2">
<h2>Open New Python3 Notebook</h2>
</section>
<section id="try-redis" class="level2">
<h2>Try redis</h2>
<pre><code>import redis
r = redis.Redis(host=&#39;redis&#39;, port=&#39;6379&#39;)
r.keys()</code></pre>
</section>
<section id="add-some-values" class="level2">
<h2>Add some values</h2>
<pre><code>r.set(&#39;foo&#39;, &#39;bar&#39;)
value = r.get(&#39;foo&#39;)
print(value)</code></pre>
</section>
<section id="drop-cluster" class="level2">
<h2>Drop cluster</h2>
<pre><code>docker-compose down</code></pre>
</section>
</section>
<section id="section-9" class="slide level1">
<h1></h1>
<section id="redis-to-track-state" class="level2">
<h2>Redis to track state</h2>
<pre><code>~/w205/redis

curl -L -o trips.csv https://goo.gl/MVNVhW</code></pre>
<aside class="notes">
<p>See nosql-kv-stores-video-hd1080-h264-30fps.mp4</p>
</aside>
</section>
<section id="spin-up-cluster" class="level2">
<h2>Spin up cluster</h2>
<pre><code>docker-compose up -d</code></pre>
</section>
<section id="run-to-get-the-token-1" class="level2">
<h2>Run to get the token</h2>
<pre><code>docker-compose logs mids</code></pre>
</section>
<section id="open-a-browser-2" class="level2">
<h2>Open a browser</h2>
<pre><code>open http://0.0.0.0:8888/?token=&lt;your token&gt;</code></pre>
</section>
<section id="open-new-python3-notebook-1" class="level2">
<h2>Open New Python3 Notebook</h2>
</section>
<section id="section-10" class="level2">
<h2></h2>
<pre><code>import redis
import pandas as pd</code></pre>
</section>
<section id="section-11" class="level2">
<h2></h2>
<pre><code>trips=pd.read_csv(&#39;trips.csv&#39;)

date_sorted_trips = trips.sort_values(by=&#39;end_date&#39;)

date_sorted_trips.head()</code></pre>
</section>
<section id="section-12" class="level2">
<h2></h2>
<pre><code>for trip in date_sorted_trips.itertuples():
  print(trip.end_date, &#39;&#39;, trip.bike_number, &#39;&#39;, trip.end_station_name)</code></pre>
</section>
<section id="section-13" class="level2">
<h2></h2>
<pre><code>current_bike_locations = redis.Redis(host=&#39;redis&#39;, port=&#39;6379&#39;)
current_bike_locations.keys()</code></pre>
</section>
<section id="add-values" class="level2">
<h2>Add values</h2>
<pre><code>for trip in date_sorted_trips.itertuples():
  current_bike_locations.set(trip.bike_number, trip.end_station_name)</code></pre>
</section>
<section id="section-14" class="level2">
<h2></h2>
<pre><code>current_bike_locations.keys()</code></pre>
</section>
<section id="where-is-bike-92" class="level2">
<h2>Where is bike 92?</h2>
<pre><code>current_bike_locations.get(&#39;92&#39;)</code></pre>
</section>
<section id="drop-cluster-1" class="level2">
<h2>Drop cluster</h2>
<pre><code>docker-compose down</code></pre>
</section>
<section id="summary" class="level2">
<h2>Summary</h2>
</section>
</section>
<section id="section-15" class="slide level1">
<h1></h1>
<section id="section-16" class="level2">
<h2></h2>
<aside class="notes">
<p>md works here</p>
</aside>
</section>
</section>
<section id="section-17" class="slide level1">
<h1></h1>
<section id="extras" class="level2">
<h2>Extras</h2>
</section>
<section id="athena-aws-cli-tool-aws" class="level2">
<h2>Athena &amp; AWS cli tool (aws)</h2>
<aside class="notes">
<p>if we need to fill time, do some queries wtih ebl data</p>
</aside>
</section>
</section>
<section id="section-18" class="slide level1">
<h1></h1>
<p><img class="logo" src="images/berkeley-school-of-information-logo.png"/></p>
</section>
    </div>
  </div>

  <script src="reveal.js/lib/js/head.min.js"></script>
  <script src="reveal.js/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Transition style
        transition: 'linear', // none/fade/slide/convex/concave/zoom

        // Optional reveal.js plugins
        dependencies: [
          { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
          { src: 'reveal.js/plugin/notes/notes.js', async: true }
        ]
      });
    </script>
    </body>
</html>
